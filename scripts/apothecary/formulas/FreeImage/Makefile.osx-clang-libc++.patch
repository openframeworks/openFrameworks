--- FreeImage/Makefile.osx	2010-05-02 22:05:18.000000000 +0100
+++ work-FreeImage/Makefile.osx	2013-09-24 16:48:21.000000000 +0100
@@ -4,31 +4,34 @@
 # This file can be generated by ./gensrclist.sh
 include Makefile.srcs
 
+# Find SDK path via xcode-select, backwards compatible with Xcode vers < 4.5
+MACOSX_SYSROOT = $(shell xcrun --show-sdk-path)
+
 # General configuration variables:
 CC_PPC = gcc-4.0
-CC_I386 = gcc-4.0
+CC_I386 = $(shell xcrun -find clang)
 CC_X86_64 = gcc-4.0
 CPP_PPC = g++-4.0
-CPP_I386 = g++-4.0
+CPP_I386 = $(shell xcrun -find clang++)
 CPP_X86_64 = g++-4.0
 COMPILERFLAGS = -Os -fexceptions -fvisibility=hidden -DNO_LCMS
 COMPILERFLAGS_PPC = -arch ppc
 COMPILERFLAGS_I386 = -arch i386
 COMPILERFLAGS_X86_64 = -arch x86_64
-COMPILERPPFLAGS = -Wno-ctor-dtor-privacy
+COMPILERPPFLAGS = -Wno-ctor-dtor-privacy -std=c++11 -stdlib=libc++ -Wc++11-narrowing
 INCLUDE += 
-INCLUDE_PPC = -isysroot /Developer/SDKs/MacOSX10.5.sdk
-INCLUDE_I386 = -isysroot /Developer/SDKs/MacOSX10.5.sdk
-INCLUDE_X86_64 = -isysroot /Developer/SDKs/MacOSX10.6.sdk
+INCLUDE_PPC = -isysroot $(MACOSX_SYSROOT)
+INCLUDE_I386 = -isysroot $(MACOSX_SYSROOT)
+INCLUDE_X86_64 = -isysroot $(MACOSX_SYSROOT)
 CFLAGS_PPC = $(COMPILERFLAGS) $(COMPILERFLAGS_PPC) $(INCLUDE) $(INCLUDE_PPC)
 CFLAGS_I386 = $(COMPILERFLAGS) $(COMPILERFLAGS_I386) $(INCLUDE) $(INCLUDE_I386)
 CFLAGS_X86_64 = $(COMPILERFLAGS) $(COMPILERFLAGS_X86_64) $(INCLUDE) $(INCLUDE_X86_64)
 CPPFLAGS_PPC = $(COMPILERPPFLAGS) $(CFLAGS_PPC)
 CPPFLAGS_I386 = $(COMPILERPPFLAGS) $(CFLAGS_I386)
 CPPFLAGS_X86_64 = $(COMPILERPPFLAGS) $(CFLAGS_X86_64)
-LIBRARIES_PPC = -Wl,-syslibroot /Developer/SDKs/MacOSX10.5.sdk
-LIBRARIES_I386 = -Wl,-syslibroot /Developer/SDKs/MacOSX10.5.sdk
-LIBRARIES_X86_64 = -Wl,-syslibroot /Developer/SDKs/MacOSX10.6.sdk
+LIBRARIES_PPC = -Wl,-syslibroot $(MACOSX_SYSROOT)
+LIBRARIES_I386 = -Wl,-syslibroot $(MACOSX_SYSROOT)
+LIBRARIES_X86_64 = -Wl,-syslibroot $(MACOSX_SYSROOT)
 LIBTOOL = libtool
 LIPO = lipo
 
@@ -50,7 +53,7 @@ PREFIX = /usr/local
 INSTALLDIR = $(PREFIX)/lib
 INCDIR = $(PREFIX)/include
 
-default: all
+default: oF-clang-libc++
 
 all: dist
 
@@ -59,6 +62,11 @@ dist: FreeImage
 	cp *.dylib Dist
 	cp Source/FreeImage.h Dist
 
+oF-clang-libc++: $(STATICLIB)-i386
+	$(LIPO) -create $(STATICLIB)-i386 -output $(STATICLIB)
+	cp *.a Dist
+	cp Source/FreeImage.h Dist
+
 FreeImage: $(STATICLIB) $(SHAREDLIB)
 
 $(STATICLIB): $(STATICLIB)-ppc $(STATICLIB)-i386 $(STATICLIB)-x86_64
