#! /bin/bash
#
# this script runs uncrustify on a given file or dir of files using the OF style config file
#
# the style file was created using Universal Indent GUI following the OF coding guidelines:
# https://github.com/openframeworks/openFrameworks/wiki/oF-code-style
#
# 2012 Dan Wilcox <danomatika@gmail.com> for openFrameworks
#
# adapted form the call_Uncrustify.sh script generated by Universal Indent GUI
#

# the uncrustify style file
CONFIG_FILE=openFrameworks_style.cfg

# comment this for debug output
QUIET=-q

###

# get the current working dir
SCRIPT_DIR=$(dirname $0)

# got any options?
if [ ! -n "$1" ]; then
	echo "Syntax is: ofStyler dirname filesuffix"
	echo "Syntax is: ofStyler filename"
	echo "Example:   ofStyler ../../../libs/openFrameworks cpp"
	exit 1
fi

# recurse through a dir
if [ -d "$1" ]; then
	
	#echo "Dir ${1} exists"
	
	if [ -n "$2" ]; then
		filesuffix=$2
	else
		filesuffix="*"
	fi

	#echo "Filtering files using suffix ${filesuffix}"

	file_list=`find ${1} -name "*.${filesuffix}" -type f`
	for file2indent in $file_list; do 
		echo "Styling file $file2indent"
		uncrustify $QUIET "$file2indent" -c $SCRIPT_DIR/$CONFIG_FILE --no-backup
	done

else
	
	# style a single given file
	if [ -f "$1" ]; then
		echo "Styling one file $1"
		uncrustify $QUIET "$1" -c $SCRIPT_DIR/$CONFIG_FILE --no-backup
	else
		echo "ERROR: directory or file does not exist!"
		echo "Syntax is: ofStyler dirname filesuffix"
		echo "Syntax is: ofStyler filename"
		echo "Example:   ofStyler ../../../libs/openFrameworks cpp"
		exit 1
	fi
fi
